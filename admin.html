<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ELECTRUM // SINGULARITY_X</title>
    <style>
        /* CSS-ЯДРО: МАКСИМАЛЬНЫЙ СТИЛЬ И СКОРОСТЬ */
        :root {
            --n: #00ff41; --bg: #000; --p: #0a0a0a; --b: #1a1a1a;
            --d: #ff003c; --a: #0081ff; --w: #ffffff;
        }
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body {
            background: var(--bg); color: var(--n); font-family: 'SF Mono', monospace;
            margin: 0; padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
            overflow: hidden; height: 100vh;
        }

        /* Глитч-эффект при загрузке */
        .boot-screen {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* Главный контейнер с GPU-ускорением */
        .app-wrapper {
            display: flex; flex-direction: column; height: 100%;
            transform: translateZ(0); opacity: 0; transition: opacity 0.5s;
        }

        /* Навигация 2.0 (Нижний бар для удобства пальцев iPhone) */
        .dock {
            display: flex; justify-content: space-around; background: var(--p);
            border-top: 1px solid var(--b); padding: 15px 0; position: fixed; bottom: 0; width: 100%;
            z-index: 100; backdrop-filter: blur(10px);
        }
        .dock-item { font-size: 10px; text-align: center; opacity: 0.5; transition: 0.3s; }
        .dock-item.active { opacity: 1; color: var(--n); text-shadow: 0 0 10px var(--n); }

        /* Динамические окна */
        .viewport { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .card {
            background: var(--p); border: 1px solid var(--b); padding: 20px;
            margin-bottom: 15px; border-radius: 8px; position: relative;
        }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: var(--n); }

        /* Поля ввода (Индустриальный стандарт) */
        input, textarea, select {
            width: 100%; background: #000; border: 1px solid var(--b); color: var(--n);
            padding: 15px; margin-top: 10px; font-family: inherit; border-radius: 4px;
        }
        input:focus { border-color: var(--n); outline: none; }

        .btn {
            background: var(--n); color: #000; border: none; padding: 18px;
            width: 100%; font-weight: 900; margin-top: 15px; border-radius: 4px;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .btn:active { transform: scale(0.98); opacity: 0.8; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="boot-screen" id="boot">
        <div id="boot-text" style="font-size: 10px; color: var(--n); width: 80%;"></div>
    </div>

    <div class="app-wrapper" id="app">
        <div style="padding: 20px; border-bottom: 1px solid var(--b); display: flex; justify-content: space-between;">
            <div style="font-weight: 900; letter-spacing: 4px;">ELECTRUM_OS</div>
            <div id="top-stats" style="font-size: 10px; color: gray;">SYNCING...</div>
        </div>

        <main class="viewport">
            <div id="v-dash" class="view">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="card"><small>REVENUE</small><div id="d-rev" style="font-size: 20px;">0₽</div></div>
                    <div class="card"><small>NODES</small><div id="d-usr" style="font-size: 20px;">0</div></div>
                </div>
                <div class="card" id="ai-predict">
                    <small>AI_MARKET_ANALYSIS</small>
                    <div style="margin-top:10px; color: var(--a); font-size: 11px;">Спрос на товары категории "Premium" вырос на 14%. Рекомендуется обновить сток.</div>
                </div>
            </div>

            <div id="v-stock" class="view hidden">
                <div class="card">
                    <select id="p-cat"></select>
                    <input id="p-name" placeholder="ITEM_NAME">
                    <input id="p-price" type="number" placeholder="PRICE_RUB">
                    <textarea id="p-raw" rows="4" placeholder="DATA_PAYLOAD_PER_LINE"></textarea>
                    <button class="btn" onclick="core.inject()">COMMIT_TO_DATABASE</button>
                </div>
                <div id="stock-list"></div>
            </div>

            <div id="v-sys" class="view hidden">
                <div class="card" id="logs" style="height: 300px; overflow-y: auto; font-size: 9px; line-height: 1.5;"></div>
                <button class="btn" style="background: var(--d);" onclick="core.wipe()">HARD_RESET_LOGS</button>
            </div>
        </main>

        <nav class="dock">
            <div class="dock-item active" onclick="core.nav('v-dash', this)">DASH</div>
            <div class="dock-item" onclick="core.nav('v-stock', this)">STOCK</div>
            <div class="dock-item" onclick="core.nav('v-sys', this)">KERN</div>
        </nav>
    </div>

    <script>
        /* ELECTRUM CORE ENGINE 2026
           -------------------------
           Оптимизировано для работы с 10,000+ записями без лагов.
        */
        const CFG = {
            k: "S6gjska68H53H64471",
            t: "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",
            r: "gol131111-ctrl/electrum-/contents/db.json"
        };

        let db = null, sha = null;

        const core = {
            async boot() {
                const logs = ["KERNEL_INIT", "DECRYPTING_STORAGE", "RSA_HANDSHAKE", "UPLINK_ESTABLISHED"];
                const out = document.getElementById('boot-text');
                for(let l of logs) {
                    out.innerHTML += `> ${l}... OK<br>`;
                    await new Promise(r => setTimeout(r, 400));
                }
                document.getElementById('boot').classList.add('hidden');
                document.getElementById('app').style.opacity = '1';
                this.sync();
            },

            async sync() {
                try {
                    const r = await fetch(`https://api.github.com/repos/${CFG.r}?v=${Date.now()}`, {
                        headers: { 'Authorization': `token ${CFG.t}` }
                    });
                    const d = await r.json(); sha = d.sha;
                    db = JSON.parse(decodeURIComponent(escape(atob(d.content))));
                    this.render();
                    this.log("DB_SYNC_COMPLETE");
                } catch(e) { this.log("SYNC_ERR_RETRYING"); setTimeout(()=>this.sync(), 5000); }
            },

            render() {
                document.getElementById('d-rev').innerText = (db.orders || []).reduce((a,b)=>a+Number(b.sum),0) + "₽";
                document.getElementById('d-usr').innerText = db.users.length;
                document.getElementById('p-cat').innerHTML = db.categories.map(c=>`<option>${c}</option>`).join('');
                
                const sList = document.getElementById('stock-list');
                sList.innerHTML = db.products.slice(-30).reverse().map((p, i) => `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                        <div><b>${p.name}</b><br><small>${p.price}₽</small></div>
                        <div style="color:var(--d)" onclick="core.del('products', ${db.products.length-1-i})">[PURGE]</div>
                    </div>
                `).join('');
            },

            async commit(msg) {
                this.log("COMMITTING_CHANGES...");
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(db, null, 2))));
                const r = await fetch(`https://api.github.com/repos/${CFG.r}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${CFG.t}` },
                    body: JSON.stringify({ message: msg, content, sha })
                });
                if(r.ok) { 
                    const res = await r.json(); sha = res.content.sha; 
                    this.log("COMMIT_SUCCESS"); this.render();
                }
            },

            inject() {
                const p = {
                    id: Date.now(),
                    name: document.getElementById('p-name').value,
                    price: document.getElementById('p-price').value,
                    secret: document.getElementById('p-raw').value,
                    cat: document.getElementById('p-cat').value
                };
                if(!p.name || !p.price) return alert("EMPTY_DATA");
                db.products.push(p);
                this.commit("INJECT_" + p.name);
            },

            del(table, idx) {
                if(confirm("DELETE_RECORD?")) {
                    db[table].splice(idx, 1);
                    this.commit("PURGE_RECORD");
                }
            },

            nav(id, el) {
                document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
                document.querySelectorAll('.dock-item').forEach(i=>i.classList.remove('active'));
                document.getElementById(id).classList.remove('hidden');
                el.classList.add('active');
            },

            log(msg) {
                const l = document.getElementById('logs');
                l.innerHTML = `<div>[${new Date().toLocaleTimeString()}] > ${msg}</div>` + l.innerHTML;
                if(!db.logs) db.logs = [];
                db.logs.push({time: new Date().toLocaleTimeString(), msg});
            },

            wipe() { if(confirm("WIPE_LOGS?")) { db.logs = []; this.commit("LOG_PURGE"); } }
        };

        core.boot();
    </script>
</body>
</html>
