<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ELECTRUM // ADMIN</title>
    <style>
        :root { --n: #00ff41; --bg: #000; --p: #0a0a0a; --b: #1a1a1a; }
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body { background: var(--bg); color: var(--n); font-family: monospace; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        .app { display: flex; flex-direction: column; height: 100%; }
        .header { padding: 20px; border-bottom: 1px solid var(--b); display: flex; justify-content: space-between; }
        .viewport { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .card { background: var(--p); border: 1px solid var(--b); padding: 20px; margin-bottom: 15px; border-left: 3px solid var(--n); }
        input, select, textarea { width: 100%; background: #000; border: 1px solid var(--b); color: var(--n); padding: 15px; margin-top: 10px; }
        .btn { background: var(--n); color: #000; border: none; padding: 18px; width: 100%; font-weight: 900; margin-top: 15px; cursor: pointer; }
        .dock { display: flex; justify-content: space-around; background: var(--p); border-top: 1px solid var(--b); padding: 20px 0; position: fixed; bottom: 0; width: 100%; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div style="font-weight:900; letter-spacing:2px;">ELECTRUM_OS</div>
            <div id="status" style="color: #ffcc00; font-size: 10px;">ПОДКЛЮЧЕНИЕ...</div>
        </div>

        <main class="viewport">
            <div id="v-dash" class="view">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="card"><small>ВЫРУЧКА</small><div id="d-rev" style="font-size:20px;">0₽</div></div>
                    <div class="card"><small>КЛИЕНТЫ</small><div id="d-usr" style="font-size:20px;">0</div></div>
                </div>
                <div class="card" style="margin-top:10px;">
                    <small>СИСТЕМНЫЕ ЛОГИ</small>
                    <div id="logs-mini" style="font-size:10px; margin-top:10px; color:#666;"></div>
                </div>
            </div>

            <div id="v-stock" class="view hidden">
                <div class="card">
                    <small>ДОБАВИТЬ ТОВАР</small>
                    <select id="p-cat"></select>
                    <input id="p-name" placeholder="НАЗВАНИЕ">
                    <input id="p-price" type="number" placeholder="ЦЕНА">
                    <textarea id="p-raw" placeholder="ДАННЫЕ (ПО ОДНОЙ СТРОКЕ)"></textarea>
                    <button class="btn" onclick="core.inject()">ЗАГРУЗИТЬ В БАЗУ</button>
                </div>
                <div id="stock-list"></div>
            </div>
        </main>

        <nav class="dock">
            <div onclick="core.nav('v-dash')">DASH</div>
            <div onclick="core.nav('v-stock')">STOCK</div>
        </nav>
    </div>

    <script>
        // Настройки строго по твоему скриншоту
        const CFG = {
            t: "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",
            r: "gol131111-ctrl/electrum-", // Имя с дефисом в конце
            f: "db.json"
        };
        
        let db = null, sha = null;

        const core = {
            async sync() {
                try {
                    const r = await fetch(`https://api.github.com/repos/${CFG.r}/contents/${CFG.f}?v=${Date.now()}`, {
                        headers: { 'Authorization': `token ${CFG.t}` }
                    });
                    if(!r.ok) throw "ОШИБКА_ДОСТУПА";
                    const d = await r.json();
                    sha = d.sha;
                    db = JSON.parse(decodeURIComponent(escape(atob(d.content))));
                    document.getElementById('status').innerText = "ONLINE";
                    document.getElementById('status').style.color = "#00ff41";
                    this.render();
                } catch(e) { 
                    document.getElementById('status').innerText = "ОШИБКА СИНХРОНИЗАЦИИ";
                    document.getElementById('status').style.color = "red";
                }
            },
            render() {
                document.getElementById('d-rev').innerText = (db.orders || []).reduce((a,b)=>a+Number(b.sum),0) + "₽";
                document.getElementById('d-usr').innerText = (db.users || []).length;
                document.getElementById('p-cat').innerHTML = (db.categories || []).map(c=>`<option>${c}</option>`).join('');
                
                document.getElementById('stock-list').innerHTML = (db.products || []).map((p, i) => `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                        <span>${p.name} <small>(${p.price}₽)</small></span>
                        <button onclick="core.del(${i})" style="background:none; border:1px solid red; color:red; padding:5px;">УДАЛИТЬ</button>
                    </div>
                `).join('');
                
                document.getElementById('logs-mini').innerHTML = (db.logs || []).slice(-3).reverse().map(l=>`<div>> ${l.msg}</div>`).join('');
            },
            async inject() {
                const p = { 
                    name: document.getElementById('p-name').value, 
                    price: document.getElementById('p-price').value, 
                    cat: document.getElementById('p-cat').value, 
                    secret: document.getElementById('p-raw').value, 
                    id: Date.now() 
                };
                if(!p.name || !p.price) return;
                db.products.push(p);
                db.logs.push({time: new Date().toLocaleTimeString(), msg: "ДОБАВЛЕН: " + p.name});
                await this.commit("UPDATE_STOCK");
            },
            async del(i) {
                if(confirm("УДАЛИТЬ?")) {
                    db.products.splice(i, 1);
                    await this.commit("DELETE_ITEM");
                }
            },
            async commit(m) {
                document.getElementById('status').innerText = "СОХРАНЕНИЕ...";
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(db, null, 2))));
                try {
                    const r = await fetch(`https://api.github.com/repos/${CFG.r}/contents/${CFG.f}`, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${CFG.t}` },
                        body: JSON.stringify({ message: m, content, sha })
                    });
                    if(r.ok) { this.sync(); }
                } catch(e) { alert("Ошибка сохранения!"); }
            },
            nav(id) {
                document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
            }
        };

        core.sync();
        setInterval(() => core.sync(), 30000); // Авто-обновление раз в 30 сек
    </script>
</body>
</html>
