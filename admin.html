<!DOCTYPE html> 
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELECTRUM ADMIN</title>
    <style>
        :root { --bg: #0f0f0f; --card: #1a1a1a; --accent: #007bff; --text: #e0e0e0; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        /* –í–•–û–î */
        .login-box { background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.7); text-align: center; width: 85%; max-width: 350px; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 10px; border: 1px solid #333; background: #111; color: white; box-sizing: border-box; font-size: 16px; }
        .btn-main { width: 100%; padding: 15px; background: var(--accent); border: none; color: white; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn-main:active { transform: scale(0.98); }
        
        /* –ê–î–ú–ò–ù–ö–ê */
        #admin-content { display: none; width: 100%; max-width: 600px; padding: 15px; box-sizing: border-box; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
        
        /* –¢–ê–ë–´ */
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; }
        .tab { flex: 1; text-align: center; padding: 12px; background: #252525; border-radius: 10px; cursor: pointer; font-size: 13px; white-space: nowrap; }
        .tab.active { background: var(--accent); font-weight: bold; }
        
        .product-item { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid var(--accent); font-size: 14px; display: flex; justify-content: space-between; }
        .hidden { display: none; }
        h1 { font-size: 22px; margin-bottom: 20px; text-align: center; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-box">
        <h2 style="color:var(--accent); letter-spacing:3px;">ELECTRUM</h2>
        <input type="text" id="user-input" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" id="pass-input" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn-main" onclick="login()">–í–û–ô–¢–ò</button>
        <p id="err" style="color: #ff4d4d; display: none; margin-top: 15px;">–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
    </div>

    <div id="admin-content">
        <h1>üíé –¶–ï–ù–¢–† –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h1>

        <div class="nav-tabs">
            <div class="tab active" onclick="showTab('sections', this)">üì¶ –†–∞–∑–¥–µ–ª—ã</div>
            <div class="tab" onclick="showTab('items', this)">üí∞ –°–∫–ª–∞–¥</div>
            <div class="tab" onclick="showTab('view', this)">üëÅ –û–±–∑–æ—Ä</div>
            <div class="tab" style="background:#e67e22;" onclick="showTab('broadcast', this)">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</div>
        </div>

        <div id="sections-part" class="card">
            <h3>–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
            <input type="text" id="new-cat" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: VIP –ê–∫–∫–∞—É–Ω—Ç—ã">
            <button class="btn-main" onclick="addCategory()">+ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª</button>
        </div>

        <div id="items-part" class="card hidden">
            <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
            <select id="p-cat"></select>
            <input type="text" id="p-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
            <input type="number" id="p-price" placeholder="–¶–µ–Ω–∞ (RUB)">
            <input type="text" id="p-img" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
            <textarea id="p-desc" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."></textarea>
            <button class="btn-main" onclick="addProduct()">üöÄ –í—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</button>
        </div>

        <div id="view-part" class="card hidden">
            <h3>–¢–µ–∫—É—â–∏–µ —Ç–æ–≤–∞—Ä—ã:</h3>
            <div id="product-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div id="broadcast-part" class="card hidden">
            <h3 style="color:#e67e22;">–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</h3>
            <p style="font-size:12px; color:#aaa;">–°–æ–æ–±—â–µ–Ω–∏–µ —É–π–¥–µ—Ç –≤—Å–µ–º, –∫—Ç–æ –Ω–∞–∂–∏–º–∞–ª /start</p>
            <textarea id="bc-text" rows="5" placeholder="–¢–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏..."></textarea>
            <button class="btn-main" style="background:#e67e22;" onclick="sendBroadcast()">üì® –û–¢–ü–†–ê–í–ò–¢–¨ –í–°–ï–ú</button>
        </div>

        <div id="status" style="display:none; text-align:center; color:#2ecc71; margin-top:15px; font-weight:bold;">‚úÖ –ì–û–¢–û–í–û!</div>
        <button onclick="location.reload()" style="width:100%; background:none; color:#555; border:none; margin-top:30px; padding:10px;">–í—ã–π—Ç–∏</button>
    </div>

    <script>
        // –¢–í–û–ò –î–ê–ù–ù–´–ï
        const AUTH = { u: "Admin2006", p: "S6gjska68H53H64471" };
        const GH = {
            token: "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", // –¢–≤–æ–π —Ç–æ–∫–µ–Ω
            repo: "gol131111-ctrl/electrum-",
            file: "db.json"
        };

        function login() {
            if(document.getElementById('user-input').value === AUTH.u && 
               document.getElementById('pass-input').value === AUTH.p) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-content').style.display = 'block';
                document.body.style.alignItems = 'flex-start';
                loadData();
            } else { document.getElementById('err').style.display = 'block'; }
        }

        function showTab(id, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
            document.getElementById(id + '-part').classList.remove('hidden');
            if(id === 'view') renderList();
        }

        async function loadData() {
            try {
                const res = await fetch(`https://api.github.com/repos/${GH.repo}/contents/${GH.file}`);
                const data = await res.json();
                const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã
                if(!content.users) content.users = [];
                if(!content.broadcast_msg) content.broadcast_msg = "";
                
                window.currentDB = content;
                window.dbSha = data.sha;
                
                const sel = document.getElementById('p-cat');
                sel.innerHTML = '';
                content.categories.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
            } catch(e) { alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã!"); }
        }

        function renderList() {
            const list = document.getElementById('product-list');
            list.innerHTML = '';
            window.currentDB.products.forEach(p => {
                list.innerHTML += `<div class="product-item"><span>${p.name}</span> <b>${p.price}‚ÇΩ</b></div>`;
            });
        }

        async function saveData() {
            const jsonStr = JSON.stringify(window.currentDB, null, 2);
            const contentEncoded = btoa(unescape(encodeURIComponent(jsonStr)));
            
            await fetch(`https://api.github.com/repos/${GH.repo}/contents/${GH.file}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${GH.token}` },
                body: JSON.stringify({ message: "Update via Admin", content: contentEncoded, sha: window.dbSha })
            });
            
            document.getElementById('status').style.display = 'block';
            setTimeout(() => location.reload(), 1500);
        }

        function addCategory() {
            const val = document.getElementById('new-cat').value;
            if(val) { window.currentDB.categories.push(val); saveData(); }
        }

        function addProduct() {
            const p = {
                id: Date.now(),
                name: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                img: document.getElementById('p-img').value,
                desc: document.getElementById('p-desc').value,
                cat: document.getElementById('p-cat').value
            };
            window.currentDB.products.push(p); saveData();
        }

        function sendBroadcast() {
            const txt = document.getElementById('bc-text').value;
            if(!txt) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!");
            if(confirm("–û—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º?")) {
                window.currentDB.broadcast_msg = txt; // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–∞–∑—É
                saveData();
            }
        }
    </script>
</body>
</html>
