<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELECTRUM ADMIN</title>
    <style>
        :root { --bg: #0f0f0f; --card: #1a1a1a; --accent: #007bff; --text: #e0e0e0; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-box { background: var(--card); padding: 30px; border-radius: 20px; text-align: center; width: 85%; max-width: 350px; border: 1px solid #333; }
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 10px; border: 1px solid #333; background: #111; color: white; box-sizing: border-box; font-size: 16px; }
        .btn-main { width: 100%; padding: 15px; background: var(--accent); border: none; color: white; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; }
        #admin-content { display: none; width: 100%; max-width: 500px; padding: 15px; box-sizing: border-box; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; }
        .tab { flex: 1; text-align: center; padding: 10px; background: #252525; border-radius: 8px; cursor: pointer; font-size: 13px; white-space: nowrap; }
        .tab.active { background: var(--accent); font-weight: bold; }
        .product-item { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid var(--accent); display: flex; justify-content: space-between; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-box">
        <h2 style="color:var(--accent);">ELECTRUM</h2>
        <input type="text" id="user-input" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" id="pass-input" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn-main" onclick="login()">–í–û–ô–¢–ò</button>
        <p id="err" style="color: #ff4d4d; display: none; margin-top:10px;">–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞</p>
    </div>

    <div id="admin-content">
        <h2 style="text-align:center;">üíé ELECTRUM PANEL</h2>
        <div class="nav-tabs">
            <div class="tab active" onclick="showTab('sections', this)">üì¶ –ë–∞–∑–∞</div>
            <div class="tab" onclick="showTab('items', this)">üí∞ –¢–æ–≤–∞—Ä</div>
            <div class="tab" onclick="showTab('view', this)">üëÅ –û–±–∑–æ—Ä</div>
            <div class="tab" style="background:#e67e22;" onclick="showTab('broadcast', this)">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</div>
        </div>

        <div id="sections-part" class="card">
            <input type="text" id="new-cat" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
            <button class="btn-main" onclick="addCategory()">+ –°–û–ó–î–ê–¢–¨ –†–ê–ó–î–ï–õ</button>
        </div>

        <div id="items-part" class="card hidden">
            <select id="p-cat"></select>
            <input type="text" id="p-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <input type="number" id="p-price" placeholder="–¶–µ–Ω–∞">
            <textarea id="p-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
            <button class="btn-main" onclick="addProduct()">üöÄ –í–´–°–¢–ê–í–ò–¢–¨</button>
        </div>

        <div id="view-part" class="card hidden"><div id="product-list"></div></div>

        <div id="broadcast-part" class="card hidden">
            <textarea id="bc-text" rows="5" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤..."></textarea>
            <button class="btn-main" style="background:#e67e22;" onclick="sendBroadcast()">üöÄ –û–¢–ü–†–ê–í–ò–¢–¨ –í–°–ï–ú</button>
        </div>
    </div>

    <script>
        const AUTH = { u: "Admin2006", p: "S6gjska68H53H64471" };
        const GH = {
            token: "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",
            repo: "gol131111-ctrl/electrum-",
            file: "db.json"
        };

        function login() {
            if(document.getElementById('user-input').value === AUTH.u && document.getElementById('pass-input').value === AUTH.p) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                loadData();
            } else { document.getElementById('err').style.display = 'block'; }
        }

        function showTab(id, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
            document.getElementById(id + '-part').classList.remove('hidden');
            if(id === 'view') renderList();
        }

        async function loadData() {
            try {
                // –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω —Å–ª–µ—à / –ø–µ—Ä–µ–¥ contents
                const res = await fetch(`https://api.github.com/repos/${GH.repo}/contents/${GH.file}`);
                const data = await res.json();
                const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                window.currentDB = content; window.dbSha = data.sha;
                const sel = document.getElementById('p-cat');
                if (sel) {
                    sel.innerHTML = '';
                    content.categories.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
                }
            } catch(e) { alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å –±–∞–∑–æ–π!"); }
        }

        async function saveData() {
            const contentEncoded = btoa(unescape(encodeURIComponent(JSON.stringify(window.currentDB, null, 2))));
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω —Å–ª–µ—à / –ø–µ—Ä–µ–¥ contents
            await fetch(`https://api.github.com/repos/${GH.repo}/contents/${GH.file}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${GH.token}` },
                body: JSON.stringify({ message: "Update", content: contentEncoded, sha: window.dbSha })
            });
            alert("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!"); location.reload();
        }

        function addCategory() {
            const v = document.getElementById('new-cat').value;
            if(v) { window.currentDB.categories.push(v); saveData(); }
        }

        function addProduct() {
            const p = { id: Date.now(), name: document.getElementById('p-name').value, price: document.getElementById('p-price').value, desc: document.getElementById('p-desc').value, cat: document.getElementById('p-cat').value };
            window.currentDB.products.push(p); saveData();
        }

        function renderList() {
            const l = document.getElementById('product-list');
            l.innerHTML = window.currentDB.products.map(p => `<div class="product-item"><span>${p.name}</span><b>${p.price}‚ÇΩ</b></div>`).join('');
        }

        function sendBroadcast() {
            const t = document.getElementById('bc-text').value;
            if(t) { window.currentDB.broadcast_msg = t; saveData(); }
        }
    </script>
</body>
</html>
